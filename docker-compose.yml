services:
  deployer:
    image: gitredware/deployer:latest
    container_name: deployer
    env_file:
      - stack.env
    environment:
      # Vault AppRole (opcional - se n√£o configurado, funciona sem Vault)
      VAULT_ADDR: "${VAULT_ADDR:-}"
      VAULT_ROLE_ID: "${VAULT_ROLE_ID:-}"
      VAULT_SECRET_ID: "${VAULT_SECRET_ID:-}"
    ports:
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /home/docker/stacks:/stacks:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 5s

# Stacks live on the host under /opt/stacks and are mounted read-only at /stacks.
